##############
多语言界面支持
##############
:category: Computer
:tags: C/C++
:date: 2005-12-07 00:07



基本方法就是采用来自其他DLL或者执行文件模块的资源来替换当前资源。可以在CWinApp派生类的InitInstance()的开头如下处理:

 .. code-block:: cpp

    HINSTANCE hInst = LoadLibrary(_T( "MainUICHN.dll" )) ;
    if(hInst !=NULL)
           AfxSetResourceHandle(hInst);

但是如果要给DLL提供多语言支持的话需要点额外的花招:

 .. code-block:: cpp   

        static AFX_EXTENSION_MODULE ProtocolDLL = { NULL, NULL };
       
        extern "C" int APIENTRY
        DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved)
        {
       	// Remove this if you use lpReserved
       	UNREFERENCED_PARAMETER(lpReserved);
       
       	if (dwReason == DLL_PROCESS_ATTACH)
       	{
       		// Extension DLL one-time initialization
       		if (!AfxInitExtensionModule(ProtocolDLL, hInstance))
       			return 0;
       
       		HINSTANCE hInst = LoadLibrary(_T( "ProtocolCHN.dll" )) ;
       		if( hInst !=NULL )
       
                               //载入中文语言资源Dll并用其handle替换当前dll的handle
       			ProtocolDLL.hResource = hInst; 
       
                       //加入resouce chain
                       new CDynLinkLibrary( ProtocolDLL ) ;
                       
               }
       
       
               // ....
       
        }

注意以上均需要资源DLL提供程序所需的全部资源。

