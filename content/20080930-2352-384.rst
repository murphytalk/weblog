############
awk二三事
############
:category: Computer
:tags: Linux
:date: 2008-09-30 23:52



额外的斜杠
---------------

在处理给定目录下的一组.tsv文件（文件名格式为IDNUMxxx.tsv，其中IDNUM是数字的ID值）时，要从文件名中取出ID，开始脚本是这么写的::

 FILES=`find $path -name "*.tsv"`
 for f in $FILES; do
    id=`echo $f|awk '{print gensub(/([^0-9]+)([0-9]+)([^0-9]+)/,"\\\\2","g",$1)}'`
 done

想法是把ID取到变量id中去，结果什么都没取到，而单独运行command substitution操作符``里面的部分时是好的。原来操作符``把双斜杠先行替换成为了单斜杠然后再awk，自然什么也没有了。需要把上面的双斜杠2写成三道斜杠和2才行。


awk的去空格
-------------------

TAB分割的两列数据文本，其第二列是一组关键字，彼此间有空格，且最后有数目不确定的尾空。需求是要分离出关键字，保留各组关键字之间的空格，但不能留头空和尾空。用下面这段awk脚本办到了::

 BEGIN {FS="\	"};
 /[0-9]+/{
    kw=gensub(/^([^ ]+.*[^ ])$/,"\\\\1","g",$2)
    gsub(/^[[:space:]]*/,"",kw)  #trim left
    gsub(/[[:space:]]*$/,"",kw)  #trim right
 }



