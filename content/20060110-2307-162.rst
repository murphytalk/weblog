##########################################
Visual C++ 2005程序的再发布
##########################################
:category: Computer
:tags: C/C++
:date: 2006-01-10 23:07



用VC++ 2005编写的程序如果不是以静态连接方式编译的话，发布时可就不是象以前那样拷贝几个mfc和c runtime的DLL就完事的了，至少在Windows XP上没这么简单。

MS现在引入了一个叫 `Side-by-side DLL <http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sbscs/setup/side_by_side_assemblies.asp>`_  的机制，把对DLL的引用过程变得复杂化，当然也有所收获：安全性得到增强了。这么做的动机之一无疑是为了解决所谓的DLL hell，付出的代价是程序发布时我们又有了新的负担：这些系统DLL没法简单拷贝了事了，我们得安装它。（不过把可能出错的步骤控制在程序的生产者手中，而简化使用者所需要关心的东西，这也不失为个好的trade-off）。

目前最标准的做法是用Windows Installer，如果用第三方setup工具的话（比如我前面用的NSIS）,最简单的做法是把VC++的DLL和对应的VC的Redist/X86子目录内Microsoft.VC80.CRT.manifest等文件一并拷贝到编译好的执行文件所在目录。但这样会丧失自动检查/更新DLL版本的功能。要是打算完整地利用起新机制就稍微麻烦些。CodeProject有剂 `对症良药 <http://www.codeproject.com/useritems/vcredists_x86.asp>`_  :D

PS. 文章里提到另一个free的setup制作工具 `Wix <http://wix.sourceforge.net/>`_  采用XML描述安装过程，感觉比NSIS好 。。。

NULL