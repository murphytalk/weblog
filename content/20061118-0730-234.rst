############################################
wxWindows:从zip文件中加载图像。
############################################
:category: Computer
:tags: C/C++
:date: 2006-11-18 07:30



wxWindows其實和MFC真的很像：外在的比如代碼風格；內在的比如充斥了宏的消息映射機制。wxWindows和MFC一樣起始于現代C++的重要特性--模板-- 還很原始的階段，所以早期版本的wxWindows和MFC一樣都仇恨使用模板、仇恨STL。但現在各自的最新版本在這方面都有很大的改善，比如MFC的CString類用模板技術重新寫過，而wxWindows的wxString則更是可以設置為直接從std::string派生。（wxWindows靈活的代碼級別可定制性也是開源項目的特色）。這幾年來在Generic Programming的勁風下，MS玩模板玩出了個WTL，相當精巧，不由想到wxWindows會不會也與時俱進呢(?);-)

但另外一方面它又有如一個增強版的MFC：不僅僅單純局限於GUI，此外還有很多能讓生活更美好的方便易用功能強大的類。

因為它的跨平台特性，它採用了自己的XRC格式的資源機制，可以使用工具直接從XRC生成C++ Code，也可以保存為XML的格式然後動態加載。我比較喜歡后一種方式：菜單啊、窗口啊都可以保存成XML然後Zip起來，運行時動態載入。需要改點界面文字或佈局什麽的話連重新編譯都不用了。

不過今天發現wxWindows的wxImage居然不直接支持從Zip中載入。所幸它支持從stream，而wxWindows又慷慨地提供了很多种stream handle，其中自然少不了zip file stream handler。嘿嘿，剩下的就是把它們揉在一起了。

用wxFFileInputStream打開一個文件stream，然後把它送給wxZipInputStream去解壓縮。wxZipInputStream提供了GetNextEntry()函數以在Zip文件中以文件/目錄單位移動。如果GetNextEntry()返回一個非空的wxZipEntry的話stream的讀取位置就被置於對應的該文件的開頭，這時就可以把wxZipInputStream喂給wxImage去讀取圖像數據了。

注意wxZipEntry對象必須由調用者釋放。