########################
完成多語言支持和搜索功能
########################
:category: Memo
:tags: Python,Memo,Django
:date: 2006-10-26 11:39



搜索功能開始做成了所謂的*live search*，也就是每輸入一個字符就開始搜索，搜索結果隨時根據輸入變化。現在暫時改成了用回車鍵提交搜索，等用IE無法搜索中文的問題解決了再改回來。嘿嘿，my first taste of Ajax，有點意思了 ^_^ 效果是模仿的Typo，本來學它也用Protype，但是不知怎麽回事情經常收不到數據接收完畢的事件，造成搜索中的動畫一直顯示。還是換回了jQuery。jQuery以其區區40K之軀，順利地幫助我達到了希望的效果，記大功一次:-D 嗯，值得研究研究。

因爲中文支持的緣故搜索暫時還沒有用MySQL的全文搜索功能，只是簡單地做了個LIKE操作，所以只能搜索連續的詞，沒法做類似用空格間隔開來的邏輯搜索操作。做了一個filter，用來在搜索結果頁面中加亮關鍵字，效果不錯。爲了在高亮處理時支持大小字符非敏感，用了re庫，而且爲了保持原文的字符的大小寫狀態，先做了一次search然後再做一次substitute，不知道對性能影響有多大。實驗下來感覺還行。

另外界面的中文支持也完成了，只要瀏覽器送過來的accept-language裏有cn，界面就採用中文。有時間做一下主動選擇界面語言的功能。

已知問題和考慮改進的地方暫列于下。

1. 用IE访问时无法搜索中文。 **UPDATE 2006/10/26 已解決** ：瀏覽器端發送字符時先用javascript的encodeURI編碼，然後在服務器端用cgi.parse_qs解碼。

1. 返回多個搜索結果時，點擊其中一項后跳轉到指定post，搜索結果就被隱藏。考慮改進為保持搜索結果的顯示直到被主動關閉。

1. "lighty's life":http://blog.lighttpd.net/的留言預覽效果很DIAO（第三聲），考慮剽竊 ^_^ 

1. 基於jQuery的"ThickBox":http://jquery.com/demo/thickbox/就更DIAO（聲調同上）了，把搜索結果做成它的實例那樣的彈出式窗口肯定很爽。
