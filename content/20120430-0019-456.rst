################################################################################
MoinMoin 1.94 + Python 2.7 + nginx 1.2.0
################################################################################
:category: Memo
:tags: DigiLife,English,Python,Memo
:date: 2012-04-30 00:19



Deployed the above combination on my new home server ;) This is a memo for future reference .

Although `ngnix <http://wiki.nginx.org>`_  supports FastCGI and wsgi directly,  due to the complexity of ngnix's fastcgi parameter configuration ,  `uwsgi <http://projects.unbit.it/uwsgi/wiki/Example#MoinMoinonlinenow>`_ is suggested.

I prefer to use my own account to run MoinMoin so I can manage the data files directly when necessary.  In this case use TCP socket instead of Unix socket otherwise nginx won't have permission to access the socket. Commands I put in `/etc/rc.local` to start uwsgi ::

 nohup /usr/bin/uwsgi --uid my-id --gid my-group -s 127.0.0.1:1717 --wsgi-file  /path/to/moin.wsgi  -p 2 -M  >/tmp/uwsgi.log 2>&1 &
 echo $!>/tmp/uwsgi.pid

ngnix configuration(inside the `server` block) ::

        #location /wiki{
        location /{
            include uwsgi_params;
            #uwsgi_param SCRIPT_NAME /wiki;
            uwsgi_param SCRIPT_NAME /;
            uwsgi_modifier1 30;
            uwsgi_pass 127.0.0.1:1717;
        }

        location /moin_static{
                alais /path/to/wiki/moin_static;
                #or use root
                #root  /path/to/wiki;
                index  index.html index.htm;
        }

This configuration directs root to MoinMoin, refer to the commented lines if want to put it under `/wiki` .

If python has been upgraded it is possible that MoinMoin's "cached page" (I guess they are *pickled*  files) is no longer compatible with the new version of Python and you will end up with a scary exception, some "dict is not executable" bla bla ... you will need to clear the cache first ::

  moin --config-dir=/path/to/wikiconfig maint cleancache


By the way, MoinMoin on the new home server is at least 10 times faster ^_^


